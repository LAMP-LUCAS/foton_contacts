<div class="card">
  <div class="card-header">
    <h5 class="mb-0"><%= l(:label_irpa_widget_title, default: 'Índice de Risco Preditivo (IRPA)') %></h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th><%= l(:label_contact) %></th>
            <th>IRPA</th>
            <th>Taxa de Atraso</th>
            <th>Índice Retrabalho</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% irpa_data.each do |data| %>
            <% 
              risk_level = case data[:risk_score]
                         when 0..45 then 'success'
                         when 45..75 then 'warning'
                         else 'danger'
                         end
              status_text = case risk_level
                            when 'success' then 'Baixo Risco'
                            when 'warning' then 'Médio Risco'
                            else 'Alto Risco'
                            end
            %>
            <tr class="table-<%= risk_level %>">
              <td><%= link_to data[:contact_name], analytics_contact_details_path(id: data[:contact_id]), data: { turbo_frame: "modal" } %></td>
              <td><span class="badge bg-<%= risk_level %>"><%= number_with_precision(data[:risk_score], precision: 1) %></span></td>
              <td><%= number_with_precision(data[:tah_percent], precision: 1) %>%</td>
              <td><%= number_with_precision(data[:ir_percent], precision: 1) %>%</td>
              <td><span class="badge bg-<%= risk_level %>"><%= status_text %></span></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>