<%# app/views/contacts/tabs/_companies.html.erb %>
<div class="splitcontentleft">
  <div class="box">
    <table class="list contact-roles">
      <thead>
        <tr>
          <th><%= l(:label_company) %></th>
          <th><%= l(:field_position) %></th>
          <th><%= l(:field_status) %></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @roles.each do |role| %>
          <tr class="<%= role.status_name %>">
            <td><%= link_to role.company.name, contact_path(role.company) %></td>
            <td><%= role.position %></td>
            <td><%= l("label_#{role.status_name}") %></td>
            <td class="buttons">
              <%= link_to l(:button_delete), contact_role_path(role),
                        method: :delete, 
                        remote: true,
                        class: 'icon icon-del',
                        data: { confirm: l(:text_are_you_sure) } if User.current.allowed_to?(:manage_contacts, @contact.project) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class="splitcontentright">
  <% if User.current.allowed_to?(:manage_contacts, @contact.project) %>
    <div class="box">
      <h3><%= l(:label_add_company_role) %></h3>
      <%= form_for ContactRole.new, remote: true do |f| %>
        <div class="box tabular">
          <p>
            <%= f.hidden_field :contact_id, value: @contact.id %>
            <%= f.select :company_id,
                      Contact.companies.active.order(:name).map { |c| [c.name, c.id] },
                      { include_blank: true },
                      required: true %>
          </p>
          <p>
            <%= f.text_field :position, required: true, size: 30 %>
          </p>
          <p>
            <%= f.select :status,
                      ContactRole.statuses.map { |k, v| [l("label_#{k}"), v] },
                      required: true %>
          </p>
          <%= submit_tag l(:button_add) %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>