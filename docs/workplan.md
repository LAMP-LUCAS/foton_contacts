# Foton Contacts

## Plano de Trabalho (Workplan)

### üß≠ Apresenta√ß√£o

Este documento descreve a primeira etapa do desenvolvimento de um plugin de **gest√£o de contatos** para o Redmine, com foco em empresas do setor de constru√ß√£o civil. O plugin visa ampliar as capacidades nativas do Redmine ao permitir o cadastro, organiza√ß√£o e vincula√ß√£o de contatos (pessoas e empresas) aos projetos, tarefas e usu√°rios, com suporte a grupos, cargos, status e hist√≥rico de relacionamento.

---

### ‚ùó Defini√ß√£o do Problema

O Redmine n√£o possui um sistema nativo para gerenciamento de contatos que permita:

- Diferenciar pessoas de empresas com campos espec√≠ficos
- Associar pessoas a m√∫ltiplas empresas com cargos distintos
- Controlar o status de v√≠nculos (ativo, inativo, descontinuado)
- Vincular contatos ou grupos de contatos a tarefas sem criar usu√°rios
- Visualizar os grupos de contatos aos quais um usu√°rio pertence
- Gerar relat√≥rios hist√≥ricos e exporta√ß√µes compat√≠veis com vCard/CSV

Essas limita√ß√µes impactam diretamente a gest√£o de equipes externas, fornecedores, clientes e prestadores de servi√ßo, especialmente em empresas que operam por projeto, como construtoras.

---

### üó∫Ô∏è Vis√£o Geral do Workplan

| Etapa        | Objetivo                                                                 |
|--------------|--------------------------------------------------------------------------|
| Fase 1       | Planejamento e modelagem dos dados e estrutura do plugin                 |
| Fase 2       | Cria√ß√£o das migra√ß√µes e estrutura√ß√£o do banco de dados                   |
| Fase 3       | Implementa√ß√£o do backend (models, controllers, l√≥gica de neg√≥cio)        |
| Fase 4       | Desenvolvimento do frontend (interfaces, formul√°rios, visualiza√ß√µes)     |
| Fase 5       | Configura√ß√£o de permiss√µes e visibilidade                                |
| Fase 6       | Testes automatizados e valida√ß√µes                                        |
| Fase 7       | Empacotamento, documenta√ß√£o e publica√ß√£o do plugin                       |

---

### üß± Fase 1 ‚Äî Planejamento e Modelagem

#### üéØ Objetivo

Criar uma base s√≥lida para o plugin de contatos, com estrutura relacional clara, integra√ß√£o nativa ao Redmine e suporte a funcionalidades avan√ßadas como:

- Separa√ß√£o entre contatos do tipo pessoa e empresa
- V√≠nculos m√∫ltiplos entre pessoas e empresas com cargos e status
- Grupos de contatos (gerais ou ef√™meros)
- Associa√ß√£o de contatos e grupos a tarefas
- Perfil de contato vinculado a cada usu√°rio Redmine
- Visualiza√ß√£o dos grupos aos quais um contato pertence

---

#### üß© Modelos de Dados

##### 1. `Contact`
Representa uma pessoa ou empresa.

```ruby
class Contact < ActiveRecord::Base
  belongs_to :author, class_name: 'User'
  belongs_to :project, optional: true
  belongs_to :user, optional: true # se for perfil de usu√°rio Redmine

  has_many :contact_roles, dependent: :destroy
  has_many :companies, through: :contact_roles, source: :company
  has_many :custom_values, as: :customized, dependent: :delete_all
  has_many :attachments, as: :container, dependent: :destroy
  has_many :contact_group_memberships, dependent: :destroy
  has_many :contact_groups, through: :contact_group_memberships
  has_many :contact_issue_links, dependent: :destroy
  has_many :issues, through: :contact_issue_links

  enum contact_type: { person: 0, company: 1 }
  enum status: { active: 0, inactive: 1, discontinued: 2 }

  validates :name, presence: true

  acts_as_customizable
  acts_as_attachable
end
```

##### 2. `ContactRole`
Relaciona uma pessoa a uma empresa com cargo e status.

```ruby
class ContactRole < ActiveRecord::Base
  belongs_to :contact # pessoa
  belongs_to :company, class_name: 'Contact' # empresa

  validates :position, presence: true
  enum status: { active: 0, inactive: 1, discontinued: 2 }
end
```

##### 3. `ContactGroup`
Agrupa contatos para uso em tarefas ou projetos.

```ruby
class ContactGroup < ActiveRecord::Base
  has_many :contact_group_memberships, dependent: :destroy
  has_many :contacts, through: :contact_group_memberships

  enum group_type: { general: 0, ephemeral: 1 }

  validates :name, presence: true
end
```

##### 4. `ContactGroupMembership`
Associa√ß√£o entre contatos e grupos.

```ruby
class ContactGroupMembership < ActiveRecord::Base
  belongs_to :contact
  belongs_to :contact_group
end
```

##### 5. `ContactIssueLink`
Vincula contatos ou grupos a tarefas.

```ruby
class ContactIssueLink < ActiveRecord::Base
  belongs_to :contact
  belongs_to :issue
end
```

---

#### üßë‚Äçüíª Controllers Principais

##### `ContactsController`
- CRUD completo
- Visualiza√ß√£o com abas: Dados, Empresas, Tarefas, Grupos, Hist√≥rico
- Exporta√ß√£o para vCard/CSV

##### `ContactRolesController`
- Gerencia v√≠nculos entre pessoas e empresas
- Permite m√∫ltiplos cargos e status

##### `ContactGroupsController`
- Cria√ß√£o de grupos ef√™meros ou gerais
- Adi√ß√£o/remo√ß√£o de contatos
- Visualiza√ß√£o dos grupos aos quais o contato pertence

##### `ContactIssueLinksController`
- Associa contatos ou grupos a tarefas
- Permite coordena√ß√£o de equipes sem criar usu√°rios

---

#### üîê Integra√ß√£o com Redmine

- Cada usu√°rio Redmine ter√° um `Contact` vinculado automaticamente
- Contatos podem ser associados a projetos e tarefas
- Permiss√µes definidas via `Redmine::AccessControl`
- Campos personalizados e anexos via sistema nativo
- Visualiza√ß√£o dos grupos de contato no perfil do usu√°rio

Excelente, Lucas! Vamos avan√ßar para a **Fase 2: Estrutura√ß√£o do Banco de Dados**, onde definimos as migra√ß√µes, relacionamentos e constraints que dar√£o sustenta√ß√£o ao plugin de contatos. A arquitetura ser√° pensada para escalabilidade, integridade referencial e total integra√ß√£o com o Redmine.

---

## üß± Fase 2 ‚Äî Estrutura√ß√£o do Banco de Dados

### üéØ Objetivo

Criar as tabelas e relacionamentos necess√°rios para suportar:

- Contatos do tipo pessoa e empresa
- V√≠nculos entre pessoas e empresas com cargos e status
- Grupos de contatos (ef√™meros ou gerais)
- Associa√ß√£o de contatos e grupos a tarefas
- Perfil de contato vinculado a usu√°rios Redmine
- Hist√≥rico de relacionamento e controle de visibilidade

---

### üìê Migra√ß√µes e Estrutura Relacional

#### 1. `contacts`
```ruby
create_table :contacts do |t|
  t.string :name, null: false
  t.string :email
  t.string :phone
  t.string :address
  t.integer :contact_type, null: false, default: 0 # person/company
  t.integer :status, null: false, default: 0 # active/inactive/discontinued
  t.references :project, foreign_key: true
  t.references :user, foreign_key: true # se for perfil de usu√°rio Redmine
  t.integer :author_id, null: false
  t.boolean :is_private, default: false
  t.timestamps
end
add_index :contacts, :name
add_index :contacts, :contact_type
add_index :contacts, :status
```

#### 2. `contact_roles`
```ruby
create_table :contact_roles do |t|
  t.references :contact, null: false, foreign_key: true # pessoa
  t.references :company, null: false, foreign_key: { to_table: :contacts } # empresa
  t.string :position, null: false
  t.integer :status, null: false, default: 0
  t.date :start_date
  t.date :end_date
  t.timestamps
end
add_index :contact_roles, [:contact_id, :company_id]
```

#### 3. `contact_groups`
```ruby
create_table :contact_groups do |t|
  t.string :name, null: false
  t.integer :group_type, null: false, default: 0 # general/ephemeral
  t.references :author, null: false
  t.timestamps
end
add_index :contact_groups, :name
```

#### 4. `contact_group_memberships`
```ruby
create_table :contact_group_memberships do |t|
  t.references :contact, null: false, foreign_key: true
  t.references :contact_group, null: false, foreign_key: true
  t.timestamps
end
add_index :contact_group_memberships, [:contact_id, :contact_group_id], unique: true
```

#### 5. `contact_issue_links`
```ruby
create_table :contact_issue_links do |t|
  t.references :contact, null: false, foreign_key: true
  t.references :issue, null: false, foreign_key: true
  t.timestamps
end
add_index :contact_issue_links, [:contact_id, :issue_id], unique: true
```

---

### üîê Constraints e Regras de Integridade

- `contact_type` deve ser `person` ou `company`
- `status` deve ser `active`, `inactive` ou `discontinued`
- Um `ContactRole` s√≥ pode existir entre uma pessoa e uma empresa
- Um `ContactGroupMembership` n√£o pode se repetir
- Um `ContactIssueLink` n√£o pode se repetir
- Se `user_id` estiver presente, o contato √© vinculado a um usu√°rio Redmine
- Se `is_private = true`, apenas o autor pode visualizar

---

### üß© Integra√ß√£o com Redmine

- `project_id` permite vincular contatos a projetos
- `user_id` conecta o contato ao perfil de usu√°rio Redmine
- `issue_id` permite vincular contatos ou grupos a tarefas
- `author_id` registra quem criou o contato ou grupo
- `custom_values` e `attachments` s√£o gerenciados via m√≥dulos nativos

---

Maravilha, Lucas! Vamos avan√ßar para a **Fase 3: Implementa√ß√£o do Backend**, onde estruturamos os **models ActiveRecord**, os **controllers principais** e a **l√≥gica de neg√≥cio** que dar√° vida ao plugin de contatos. Tudo ser√° constru√≠do com foco em integra√ß√£o nativa ao Redmine, extensibilidade e clareza de prop√≥sito.

---

## üßë‚Äçüíª Fase 3 ‚Äî Implementa√ß√£o do Backend

### üéØ Objetivo

Implementar os modelos e controllers com:

- Valida√ß√µes e relacionamentos s√≥lidos
- L√≥gica de CRUD inteligente para pessoas e empresas
- Associa√ß√£o de contatos a tarefas e projetos
- Grupos de contatos reutiliz√°veis ou ef√™meros
- Perfil de contato vinculado a usu√°rios Redmine
- Escopos e m√©todos auxiliares para filtros, BI e visualiza√ß√£o

---

### üß± Models ActiveRecord

#### 1. `Contact`
```ruby
class Contact < ActiveRecord::Base
  belongs_to :author, class_name: 'User'
  belongs_to :project, optional: true
  belongs_to :user, optional: true # perfil de usu√°rio Redmine

  has_many :contact_roles, dependent: :destroy
  has_many :companies, through: :contact_roles, source: :company
  has_many :contact_group_memberships, dependent: :destroy
  has_many :contact_groups, through: :contact_group_memberships
  has_many :contact_issue_links, dependent: :destroy
  has_many :issues, through: :contact_issue_links
  has_many :custom_values, as: :customized, dependent: :delete_all
  has_many :attachments, as: :container, dependent: :destroy

  enum contact_type: { person: 0, company: 1 }
  enum status: { active: 0, inactive: 1, discontinued: 2 }

  validates :name, presence: true

  scope :visible_to, ->(user) {
    where(is_private: false).or(where(author_id: user.id))
  }

  acts_as_customizable
  acts_as_attachable
end
```

---

#### 2. `ContactRole`
```ruby
class ContactRole < ActiveRecord::Base
  belongs_to :contact # pessoa
  belongs_to :company, class_name: 'Contact' # empresa

  enum status: { active: 0, inactive: 1, discontinued: 2 }

  validates :position, presence: true
  validates :contact_id, uniqueness: { scope: [:company_id, :position] }
end
```

---

#### 3. `ContactGroup`
```ruby
class ContactGroup < ActiveRecord::Base
  belongs_to :author, class_name: 'User'
  has_many :contact_group_memberships, dependent: :destroy
  has_many :contacts, through: :contact_group_memberships

  enum group_type: { general: 0, ephemeral: 1 }

  validates :name, presence: true
end
```

---

#### 4. `ContactGroupMembership`
```ruby
class ContactGroupMembership < ActiveRecord::Base
  belongs_to :contact
  belongs_to :contact_group

  validates :contact_id, uniqueness: { scope: :contact_group_id }
end
```

---

#### 5. `ContactIssueLink`
```ruby
class ContactIssueLink < ActiveRecord::Base
  belongs_to :contact
  belongs_to :issue

  validates :contact_id, uniqueness: { scope: :issue_id }
end
```

---

### üßë‚Äçüíª Controllers Principais

#### `ContactsController`

```ruby
class ContactsController < ApplicationController
  before_action :find_contact, only: [:show, :edit, :update, :destroy]
  before_action :authorize_contact, only: [:show, :edit, :update, :destroy]

  def index
    @contacts = Contact.visible_to(User.current).includes(:project, :contact_groups)
  end

  def show; end

  def new
    @contact = Contact.new(contact_type: params[:type])
  end

  def create
    @contact = Contact.new(contact_params)
    @contact.author = User.current
    if @contact.save
      redirect_to @contact
    else
      render :new
    end
  end

  def edit; end

  def update
    if @contact.update(contact_params)
      redirect_to @contact
    else
      render :edit
    end
  end

  def destroy
    @contact.destroy
    redirect_to contacts_path
  end

  private

  def contact_params
    params.require(:contact).permit(:name, :email, :phone, :address, :contact_type, :status, :project_id, :user_id, :is_private)
  end

  def find_contact
    @contact = Contact.find(params[:id])
  end

  def authorize_contact
    render_403 unless @contact.is_private == false || @contact.author == User.current
  end
end
```

---

#### `ContactGroupsController`

```ruby
class ContactGroupsController < ApplicationController
  def index
    @groups = ContactGroup.where(author: User.current)
  end

  def show
    @group = ContactGroup.find(params[:id])
    @contacts = @group.contacts
  end

  def new
    @group = ContactGroup.new
  end

  def create
    @group = ContactGroup.new(group_params)
    @group.author = User.current
    if @group.save
      redirect_to @group
    else
      render :new
    end
  end

  def destroy
    @group = ContactGroup.find(params[:id])
    @group.destroy
    redirect_to contact_groups_path
  end

  private

  def group_params
    params.require(:contact_group).permit(:name, :group_type)
  end
end
```

---

#### `ContactIssueLinksController`

```ruby
class ContactIssueLinksController < ApplicationController
  def create
    @link = ContactIssueLink.new(link_params)
    if @link.save
      redirect_to issue_path(@link.issue)
    else
      render :new
    end
  end

  def destroy
    @link = ContactIssueLink.find(params[:id])
    @link.destroy
    redirect_to issue_path(@link.issue)
  end

  private

  def link_params
    params.require(:contact_issue_link).permit(:contact_id, :issue_id)
  end
end
```

---

### üîê Permiss√µes e Escopos

- Permiss√µes via `Redmine::AccessControl`:
  - `:view_contacts`, `:edit_contacts`, `:manage_contact_groups`, `:link_contacts_to_issues`
- Escopos:
  - `Contact.visible_to(user)` para filtrar por visibilidade
  - `ContactGroup.where(author: user)` para grupos pessoais
  - `ContactRole.active` para v√≠nculos ativos

---

Perfeito, Lucas! Vamos para a **Fase 4: Desenvolvimento do Frontend**, com foco em uma interface fluida, integrada ao Redmine, e pensada para usabilidade real em ambientes corporativos. A proposta a seguir respeita os padr√µes visuais e funcionais do Redmine, mas traz uma camada moderna de experi√™ncia para o m√≥dulo de contatos.

---

## üé® Fase 4 ‚Äî Frontend e Experi√™ncia do Usu√°rio

### üß≠ Vis√£o Geral

**Objetivo:** Criar uma interface robusta, responsiva e intuitiva para o gerenciamento de contatos, com foco em:

- Integra√ß√£o nativa ao Redmine (menus, permiss√µes, estilos)
- Visualiza√ß√£o anal√≠tica (BI) em aba dedicada
- Opera√ß√µes r√°pidas (CRUD, importa√ß√£o, vincula√ß√£o)
- Resili√™ncia contra dados ausentes ou corrompidos
- Compatibilidade com telas grandes e dispositivos m√≥veis

---

### üß© Estrutura de Navega√ß√£o

#### üîß Configura√ß√µes
- Local: `Administra√ß√£o ‚Üí Configura√ß√µes ‚Üí Contatos`
- Itens configur√°veis:
  - Campos personalizados
  - Tipos de contato
  - Permiss√µes por fun√ß√£o
  - Mapeamento de campos para CSV/vCard
  - Visibilidade padr√£o (global, privada, por projeto)

#### üìä Aba ‚ÄúContacts‚Äù no menu principal
- Local: `Menu superior ‚Üí Contacts`
- Vis√≠vel apenas para usu√°rios com permiss√£o `:view_contacts`
- Subdividida em:
  - **Tabela de contatos**
  - **Bot√µes de a√ß√£o**
  - **Modal de an√°lise (BI)**

---

### üñ•Ô∏è Tela Principal: Aba ‚ÄúContacts‚Äù

#### üîò Bot√µes de A√ß√£o (topo da aba)
- ‚ûï **Novo Contato** ‚Üí abre formul√°rio modal com campos din√¢micos por tipo
- üì• **Importar CSV/vCard** ‚Üí abre modal com upload e mapeamento de campos
- üîç **Filtrar por tipo/status/projeto** ‚Üí filtros laterais ou dropdown
- üìä **An√°lise de Contato** ‚Üí bot√£o em cada linha da tabela que abre modal BI

---

#### üìã Tabela Paginada de Contatos

| Nome         | Tipo     | Status     | Projeto     | Empresas Vinculadas | A√ß√µes |
|--------------|----------|------------|-------------|----------------------|-------|
| Jo√£o Silva   | Pessoa   | Ativo      | Obra A      | Construtora X        | üîç ‚úèÔ∏è üóëÔ∏è |
| Construtora X| Empresa  | Ativo      | Obra A      | ‚Äî                    | üîç ‚úèÔ∏è üóëÔ∏è |

- Colunas orden√°veis
- Pagina√ß√£o com op√ß√£o de 10/25/50/100 por p√°gina
- √çcones de a√ß√£o:
  - üîç Visualizar (abre modal BI)
  - ‚úèÔ∏è Editar
  - üóëÔ∏è Excluir (com confirma√ß√£o)

---

### üìä Modal de An√°lise (BI)

#### Abertura
- Acessado via bot√£o üîç na tabela
- Modal responsivo com abas internas

#### Conte√∫do

##### üß¨ Aba 1: V√≠nculos
- Quantidade de empresas vinculadas
- Cargos ocupados e status
- Per√≠odo de cada v√≠nculo

##### üèóÔ∏è Aba 2: Rela√ß√µes com Projetos
- Projetos associados
- Tarefas vinculadas (por tipo de issue)
- √öltima atividade registrada

##### üìà Aba 3: Carreira
- Linha do tempo dos v√≠nculos
- Evolu√ß√£o de cargos
- Participa√ß√£o em grupos e tarefas

##### ‚ö†Ô∏è Aba 4: Alertas e Inconsist√™ncias
- Dados ausentes (e-mail, telefone, empresa)
- V√≠nculos sem cargo definido
- Contatos duplicados (por nome ou e-mail)

---

### üì± Responsividade e UX

- Layout adapt√°vel para mobile (colunas colaps√°veis, bot√µes flutuantes)
- Modal com scroll interno e navega√ß√£o por abas
- Feedback visual para a√ß√µes (salvo, erro, carregando)
- Mensagens amig√°veis para base de dados vazia:
  > ‚ÄúNenhum contato encontrado. Que tal come√ßar cadastrando o primeiro?‚Äù

---

### üõ°Ô∏è Resili√™ncia e Seguran√ßa

- Valida√ß√£o de dados no frontend e backend
- Tratamento de erros para dados corrompidos ou ausentes
- Fallback para campos nulos (ex: ‚Äú‚Äî‚Äù ou ‚ÄúN√£o informado‚Äù)
- Permiss√µes respeitadas em cada a√ß√£o e visualiza√ß√£o

---

### üîó Integra√ß√£o com Redmine

- Usa estilos e componentes nativos (`application.css`, `form_tag`, `link_to`)
- Campos personalizados via `CustomFields`
- Anexos via `Attachments`
- Permiss√µes via `Redmine::AccessControl`
- Navega√ß√£o via `menu_item`, `project_menu`, `admin_menu`

---

Perfeito, Lucas! Vamos avan√ßar para a **Fase 5: Permiss√µes e Visibilidade**, que garante que o plugin de contatos funcione com seguran√ßa, controle de acesso e integra√ß√£o total com o sistema de permiss√µes do Redmine. Essa etapa √© essencial para proteger dados sens√≠veis, evitar duplicidade de l√≥gica e manter a fluidez da experi√™ncia para diferentes perfis de usu√°rio.

---

## üîê Fase 5 ‚Äî Permiss√µes e Visibilidade

### üéØ Objetivo

Definir e implementar um sistema de permiss√µes que:

- Controle quem pode visualizar, editar, excluir e vincular contatos
- Respeite a l√≥gica de escopo (global, privado, por projeto)
- Integre-se perfeitamente ao sistema de **Roles**, **User Types** e **Projects** do Redmine
- Permita que usu√°rios visualizem os grupos de contatos aos quais pertencem
- Evite exposi√ß√£o indevida de dados pessoais ou corporativos

---

### üß© Permiss√µes por Fun√ß√£o (Roles)

Configuradas em:  
**Administra√ß√£o ‚Üí Fun√ß√µes ‚Üí Permiss√µes ‚Üí Contatos**

#### Permiss√µes dispon√≠veis:

| Permiss√£o                      | Descri√ß√£o                                                                 |
|-------------------------------|---------------------------------------------------------------------------|
| `view_contacts`               | Ver contatos (pessoais, empresas, vinculados a projetos)                  |
| `edit_contacts`               | Editar dados de contatos                                                  |
| `delete_contacts`             | Excluir contatos                                                          |
| `manage_contact_groups`       | Criar, editar e excluir grupos de contatos                                |
| `link_contacts_to_issues`     | Associar contatos ou grupos a tarefas                                     |
| `view_contact_analysis`       | Acessar modal de an√°lise (BI)                                             |
| `import_contacts`             | Importar contatos via CSV ou vCard                                        |
| `export_contacts`             | Exportar contatos para vCard, QR code ou XML                              |

---

### üë§ Permiss√µes por Tipo de Usu√°rio (User Types)

Configuradas em:  
**Administra√ß√£o ‚Üí Tipos de Usu√°rio ‚Üí Visibilidade de Contatos**

#### Op√ß√µes:

- Tipos de contato vis√≠veis: pessoa, empresa, conta
- Escopo de visualiza√ß√£o:
  - Apenas contatos pr√≥prios
  - Contatos do projeto atual
  - Contatos globais
  - Contatos de grupos aos quais pertence

---

### üß† L√≥gica de Visibilidade

#### Escopos de contato:

| Escopo         | Vis√≠vel para...                                               |
|----------------|---------------------------------------------------------------|
| Global         | Todos os usu√°rios com permiss√£o `view_contacts`               |
| Privado        | Somente o autor do contato                                    |
| Por projeto    | Usu√°rios com acesso ao projeto vinculado                      |
| Por grupo      | Usu√°rios que pertencem ao grupo de contato                    |

#### Regras adicionais:

- Contatos vinculados a tarefas s√£o vis√≠veis para quem tem acesso √† tarefa
- Contatos vinculados a usu√°rios Redmine s√£o vis√≠veis conforme permiss√µes do usu√°rio
- Contatos com `is_private = true` s√£o ocultos mesmo para administradores

---

### üë• Visualiza√ß√£o de Grupos

Cada usu√°rio poder√° ver:

- Os grupos de contatos que criou
- Os grupos aos quais pertence
- Os contatos dentro desses grupos (respeitando escopo e permiss√µes)

Exibido em:

- Aba ‚ÄúContacts‚Äù ‚Üí Filtro ‚ÄúMeus grupos‚Äù
- Perfil do usu√°rio ‚Üí Aba ‚ÄúPerfil de Contato‚Äù ‚Üí Se√ß√£o ‚ÄúGrupos‚Äù

---

### üõ°Ô∏è Seguran√ßa e Resili√™ncia

- Todas as a√ß√µes passam por `before_action :authorize_contact`
- Visualiza√ß√µes filtradas por escopo e permiss√µes
- Campos sens√≠veis (e-mail, telefone) ocultos em alertas e notifica√ß√µes
- Logs de acesso e modifica√ß√£o para auditoria futura
- Fallbacks visuais para dados ausentes ou restritos:
  > ‚ÄúEste contato √© privado ou voc√™ n√£o tem permiss√£o para visualiz√°-lo.‚Äù

---

### üîó Integra√ß√£o com Redmine

- Usa `Redmine::AccessControl` para definir permiss√µes
- Respeita `User.current.allowed_to?` em todas as a√ß√µes
- Integra com `Project.visible?`, `Issue.visible?`, `User.visible?`
- Configura√ß√µes centralizadas em menus nativos de administra√ß√£o

---

Perfeito, Lucas! Vamos para a **Fase 6: Testes e Valida√ß√µes**, que garante que o plugin de contatos seja confi√°vel, seguro e funcional em todos os cen√°rios ‚Äî desde o uso cotidiano at√© situa√ß√µes extremas como base de dados corrompida ou aus√™ncia de dados.

---

# üß™ Fase 6 ‚Äî Testes e Valida√ß√µes

---

## üéØ Objetivo

- Garantir que todas as funcionalidades do plugin funcionem corretamente
- Validar regras de neg√≥cio, permiss√µes e escopos
- Prevenir falhas em ambientes com dados incompletos ou inconsistentes
- Assegurar compatibilidade com diferentes perfis de usu√°rio e dispositivos

---

## üß± Tipos de Testes

| Tipo de Teste         | Finalidade                                                                 |
|------------------------|---------------------------------------------------------------------------|
| Testes Unit√°rios       | Validar modelos, m√©todos auxiliares e regras de valida√ß√£o                 |
| Testes de Integra√ß√£o   | Verificar fluxo entre controllers, views e banco de dados                 |
| Testes de Permiss√£o    | Confirmar que cada usu√°rio v√™ e acessa apenas o que tem direito           |
| Testes de Interface    | Garantir que a UI responde corretamente em desktop e mobile               |
| Testes de Resili√™ncia  | Simular dados corrompidos, ausentes ou duplicados                         |
| Testes de Importa√ß√£o   | Validar mapeamento e tratamento de arquivos CSV/vCard                     |
| Testes de Exporta√ß√£o   | Verificar formato e conte√∫do de vCard, QR code e XML                      |

---

## ‚úÖ Testes Unit√°rios (RSpec)

### `Contact`
- Cria√ß√£o com campos obrigat√≥rios
- Valida√ß√£o de tipos (`person`, `company`)
- Escopo `visible_to(user)`
- Associa√ß√£o com `user`, `project`, `groups`, `issues`

### `ContactRole`
- V√≠nculo entre pessoa e empresa
- Valida√ß√£o de cargo e status
- Unicidade por pessoa + empresa + cargo

### `ContactGroup`
- Cria√ß√£o com nome e tipo
- Associa√ß√£o com contatos
- Exclus√£o em cascata

---

## üîÑ Testes de Integra√ß√£o (Capybara)

### Fluxos principais
- Criar contato (pessoa e empresa)
- Editar e excluir contato
- Vincular contato a tarefa
- Criar grupo e adicionar membros
- Visualizar grupos aos quais o usu√°rio pertence
- Abrir modal de an√°lise (BI)

### Situa√ß√µes especiais
- Contato sem empresa vinculada
- Contato com m√∫ltiplos v√≠nculos e cargos
- Grupo ef√™mero com contatos privados

---

## üîê Testes de Permiss√µes

- Usu√°rio sem `view_contacts` n√£o acessa aba ‚ÄúContacts‚Äù
- Usu√°rio com `edit_contacts` pode alterar apenas contatos vis√≠veis
- Contato privado vis√≠vel apenas ao autor
- Grupo vis√≠vel apenas ao criador e membros
- Tarefa com contato vinculado vis√≠vel conforme escopo da tarefa

---

## üì± Testes de Interface

- Layout responsivo em mobile (colunas colaps√°veis, bot√µes flutuantes)
- Modal de an√°lise com scroll interno e abas funcionais
- Mensagens amig√°veis para base vazia:
  > ‚ÄúNenhum contato encontrado. Que tal come√ßar cadastrando o primeiro?‚Äù

---

## üõ°Ô∏è Testes de Resili√™ncia

- Contato com campos nulos (telefone, e-mail, empresa)
- Dados corrompidos (empresa inexistente, cargo vazio)
- CSV com colunas fora de ordem ou campos ausentes
- vCard com campos n√£o mapeados

---

## üì§ Testes de Importa√ß√£o e Exporta√ß√£o

- Importar CSV com mapeamento correto
- Importar vCard com m√∫ltiplos contatos
- Exportar contato para vCard e QR code
- Validar conte√∫do e formato dos arquivos gerados

---

## üß© Integra√ß√£o com Redmine

- Testes com usu√°rios reais e fict√≠cios
- Testes em projetos com e sem tarefas
- Testes com permiss√µes variadas
- Testes com campos personalizados e anexos

---

Perfeito, Lucas! Vamos concluir com a **Fase 7: Empacotamento, Documenta√ß√£o e Publica√ß√£o**, que transforma todo o trabalho t√©cnico em um produto utiliz√°vel, seguro e bem documentado. Esta fase √© essencial para garantir que o plugin seja facilmente instalado, compreendido e mantido por desenvolvedores e usu√°rios ‚Äî com foco absoluto em clareza, usabilidade e integra√ß√£o nativa ao Redmine.

---

## üì¶ Fase 7 ‚Äî Empacotamento, Documenta√ß√£o e Publica√ß√£o

### üéØ Objetivo

- Empacotar o plugin com estrutura padr√£o Redmine
- Criar documenta√ß√£o t√©cnica e de uso clara, acess√≠vel e atualizada
- Garantir seguran√ßa, resili√™ncia e compatibilidade com vers√µes do Redmine
- Oferecer suporte √† instala√ß√£o, configura√ß√£o e opera√ß√£o
- Guiar o usu√°rio com foco em UI/UX e continuidade da experi√™ncia

---

### üìÅ Estrutura do Plugin

```plaintext
redmine_contacts/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îî‚îÄ‚îÄ helpers/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ routes.rb
‚îÇ   ‚îî‚îÄ‚îÄ initializers/
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ migrate/
‚îÇ   ‚îî‚îÄ‚îÄ seeds.rb
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ redmine_contacts/
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ stylesheets/
‚îÇ   ‚îî‚îÄ‚îÄ javascripts/
‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îî‚îÄ‚îÄ pt-BR.yml
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îî‚îÄ‚îÄ unit/
‚îÇ   ‚îî‚îÄ‚îÄ integration/
‚îú‚îÄ‚îÄ init.rb
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ LICENSE
```

---

### üìò Documenta√ß√£o T√©cnica

#### 1. Instala√ß√£o

```markdown
### Instala√ß√£o do Plugin de Contatos

1. Clone o reposit√≥rio na pasta `plugins` do Redmine:
   git clone https://github.com/seu-usuario/redmine_contacts plugins/redmine_contacts

2. Execute as migra√ß√µes:
   bundle exec rake redmine:plugins:migrate RAILS_ENV=production

3. Reinicie o servidor:
   sudo systemctl restart redmine
```

---

#### 2. Configura√ß√£o

- Acesse: **Administra√ß√£o ‚Üí Configura√ß√µes ‚Üí Contatos**
- Configure:
  - Campos personalizados
  - Tipos de contato
  - Permiss√µes por fun√ß√£o
  - Mapeamento de campos para CSV/vCard
  - Visibilidade padr√£o

---

#### 3. Permiss√µes

| Permiss√£o                  | Descri√ß√£o                                      |
|---------------------------|------------------------------------------------|
| `view_contacts`           | Ver contatos                                   |
| `edit_contacts`           | Editar contatos                                |
| `delete_contacts`         | Excluir contatos                               |
| `manage_contact_groups`   | Gerenciar grupos                               |
| `link_contacts_to_issues` | Associar contatos a tarefas                    |
| `view_contact_analysis`   | Acessar visualiza√ß√£o anal√≠tica (BI)            |
| `import_contacts`         | Importar CSV/vCard                             |
| `export_contacts`         | Exportar vCard, QR code, XML                   |

---

#### 4. Uso do Plugin

##### üìá Cadastro de Contatos

- Acesse a aba **Contacts**
- Clique em **Novo Contato**
- Escolha o tipo: Pessoa ou Empresa
- Preencha os campos nativos e personalizados
- Salve e vincule a projetos, tarefas ou grupos

##### üì• Importa√ß√£o

- Clique em **Importar CSV/vCard**
- Fa√ßa upload e mapeie os campos
- Visualize os contatos importados

##### üìä Visualiza√ß√£o Anal√≠tica

- Clique no √≠cone üîç na tabela de contatos
- Modal com abas:
  - V√≠nculos
  - Rela√ß√µes com projetos
  - Carreira
  - Alertas e inconsist√™ncias

---

### üßë‚Äçüíª Documenta√ß√£o para Desenvolvedores

#### Hooks dispon√≠veis

- `view_issues_show_details_bottom`
- `view_projects_show_sidebar`
- `view_users_show_right`

#### APIs REST

- `GET /contacts`
- `POST /contacts`
- `PUT /contacts/:id`
- `DELETE /contacts/:id`

#### Testes

- Executar com:
  ```bash
  bundle exec rake test RAILS_ENV=test
  ```

---

### üõ°Ô∏è Diretrizes de Seguran√ßa e Resili√™ncia

- Valida√ß√£o de dados em todos os modelos
- Tratamento de erros para dados ausentes ou corrompidos
- Fallbacks visuais para campos nulos
- Logs de acesso e modifica√ß√£o
- Controle de visibilidade por escopo e permiss√µes
- Compatibilidade com Redmine 5.x e superior

---

### üé® Diretrizes de UI/UX

- Interface responsiva para mobile e desktop
- Navega√ß√£o fluida com abas e modais
- Feedback visual para a√ß√µes (salvo, erro, carregando)
- Mensagens amig√°veis para base vazia
- Consist√™ncia com estilos nativos do Redmine
- Acessibilidade para teclado e leitores de tela

---

### üì§ Publica√ß√£o e Distribui√ß√£o

- Reposit√≥rio GitHub com tag de vers√£o
- P√°gina oficial com changelog e instru√ß√µes
- Compatibilidade com Redmine Plugin Registry
- Licen√ßa GNU General Public License v3.0
- Suporte via issues no GitHub e documenta√ß√£o atualizada
